---
description: Testing guidelines and best practices for both Django backend and Angular frontend
globs: **/*test*.py, **/*.spec.ts, **/test_*.py, **/tests.py
alwaysApply: false
---

# Testing Rules for Termageddon

## General Testing Principles
- Always maintain working unit and integration tests
- Don't write e2e tests (as per user preference)
- Ensure existing tests pass before making changes
- Write tests for new features and bug fixes

## Manual Browser Testing for Bug Fixes

### Before Fixing a Bug
- **Always verify the bug exists** by manually testing in the browser using Cursor's browser tools
- Navigate to the affected page/feature and reproduce the reported issue
- Document the exact steps to reproduce and the observed behavior
- Take screenshots or note the specific error messages/behaviors
- Confirm the bug is present before starting any code changes

### After Fixing a Bug
- **Always verify the fix works** by manually testing in the browser using Cursor's browser tools
- Follow the same steps used to reproduce the bug
- Confirm the bug is no longer present and the expected behavior is restored
- Test related functionality to ensure the fix didn't introduce regressions
- Test edge cases and error scenarios related to the fix

### Testing Workflow
1. **Reproduce**: Use browser tools to navigate and interact with the application to reproduce the bug
2. **Fix**: Implement the code fix
3. **Verify**: Use browser tools again to confirm the fix resolves the issue
4. **Validate**: Test related features to ensure no regressions were introduced

### Browser Testing Tools
- Use Cursor's built-in browser automation tools (Playwright) for manual testing
- Navigate to `http://localhost:4200` for frontend testing
- Ensure backend is running on `http://localhost:8000`
- Use test user credentials from `test-plan.md` for authentication
- Test with different user roles when relevant (admin, perspective curator, regular user)

## Django Backend Testing
- Use pytest with pytest-django
- Write tests in `glossary/tests/` directory
- Use factory-boy for test data generation
- Test models, views, serializers, and API endpoints
- Aim for 90%+ test coverage
- Use descriptive test names that explain the scenario

### Test Structure
```python
def test_model_creation_with_valid_data():
    """Test that model can be created with valid data"""
    pass

def test_api_endpoint_returns_correct_data():
    """Test that API endpoint returns expected data structure"""
    pass
```

### Test Data
- Use factories for consistent test data
- Create test fixtures in `conftest.py`
- Use `@pytest.mark.django_db` for database tests
- Clean up test data after each test

### API Testing
- Test authentication requirements
- Test permission checks
- Test data validation
- Test error handling
- Test pagination and filtering

## Angular Frontend Testing
- Use Jasmine and Karma for unit tests
- Test components, services, and pipes
- Mock external dependencies
- Test user interactions and error scenarios

### Component Testing
```typescript
describe('ComponentName', () => {
  let component: ComponentName;
  let fixture: ComponentFixture<ComponentName>;

  beforeEach(() => {
    TestBed.configureTestingModule({
      imports: [ComponentName]
    });
    fixture = TestBed.createComponent(ComponentName);
    component = fixture.componentInstance;
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});
```

### Service Testing
- Mock HTTP calls with HttpClientTestingModule
- Test error handling
- Test data transformation
- Test observable streams

## Test Organization
- Group related tests in describe blocks
- Use beforeEach/afterEach for setup/cleanup
- Keep tests independent and isolated
- Use meaningful test descriptions

## Running Tests
- Backend: `pytest` or `python -m pytest`
- Frontend: `ng test` or `npm test`
- Run tests before committing changes
- Fix failing tests immediately

## Test Data Management
- Use realistic test data that matches production scenarios
- Avoid hardcoded values in tests
- Use factories for complex object creation
- Clean up test data to avoid test pollution
