<div class="search-filter-bar space-y-3">
  <!-- Search Input -->
  <div class="relative">
    <input
      type="text"
      [(ngModel)]="searchTerm"
      (ngModelChange)="onSearchInput()"
      (keypress)="onKeyPress($event)"
      [placeholder]="placeholder"
      class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-termageddon-accent text-sm"
    />
    @if (showClearButton && searchTerm) {
      <button
        (click)="onClear()"
        class="absolute right-2 top-2 text-gray-400 hover:text-gray-600"
      >
        âœ•
      </button>
    }
    @if (loading) {
      <div class="absolute right-2 top-2">
        <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-termageddon-accent"></div>
      </div>
    }
  </div>

  <!-- Unified Filters -->
  <div class="filters-container space-y-3">
    <!-- Perspective Filter -->
    @if (showPerspectiveFilter) {
      <select
        [value]="selectedPerspectiveId || ''"
        (change)="onPerspectiveChange($event)"
        class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-termageddon-accent text-sm"
      >
        <option value="">All Perspectives</option>
        @for (perspective of perspectives; track perspective.id) {
          <option [value]="perspective.id">{{ perspective.name }}</option>
        }
      </select>
    }

    <!-- Author Filter -->
    @if (showAuthorFilter) {
      <select
        [value]="selectedAuthorId || ''"
        (change)="onAuthorChange($event)"
        class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-termageddon-accent text-sm"
      >
        <option value="">All Authors</option>
        @for (author of authors; track author.id) {
          <option [value]="author.id">{{ author.username }}</option>
        }
      </select>
    }

    <!-- Sort Options -->
    @if (showSortOptions) {
      <div class="flex items-center space-x-2">
        <label class="text-sm text-gray-600">Sort by:</label>
        <select
          [value]="selectedSortBy"
          (change)="onSortChange($event)"
          class="px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-termageddon-accent text-sm"
        >
          @for (option of sortOptions; track option.value) {
            <option [value]="option.value">{{ option.label }}</option>
          }
        </select>
      </div>
    }
  </div>

  <!-- Legacy Filters -->
  @if (filters.length > 0) {
    <div class="filters-container">
      @for (filter of filters; track filter.id) {
        <div class="filter-item">
          @switch (filter.type) {
            @case ('checkbox') {
              <div class="flex items-center">
                <input
                  type="checkbox"
                  [id]="filter.id"
                  [checked]="filter.value"
                  (change)="onCheckboxChange(filter.id, $event)"
                  class="mr-2"
                />
                <label [for]="filter.id" class="text-sm text-gray-600">
                  {{ filter.label }}
                </label>
              </div>
            }
            @case ('select') {
              <div class="flex items-center space-x-2">
                <label [for]="filter.id" class="text-sm text-gray-600">
                  {{ filter.label }}:
                </label>
                <select
                  [id]="filter.id"
                  [value]="filter.value"
                  (change)="onSelectChange(filter.id, $event)"
                  class="px-2 py-1 border border-gray-300 rounded text-sm"
                >
                  @for (option of filter.options; track option.value) {
                    <option [value]="option.value">{{ option.label }}</option>
                  }
                </select>
              </div>
            }
            @case ('text') {
              <div class="flex items-center space-x-2">
                <label [for]="filter.id" class="text-sm text-gray-600">
                  {{ filter.label }}:
                </label>
                <input
                  type="text"
                  [id]="filter.id"
                  [value]="filter.value"
                  (input)="onTextChange(filter.id, $event)"
                  class="px-2 py-1 border border-gray-300 rounded text-sm"
                />
              </div>
            }
          }
        </div>
      }
    </div>
  }
</div>
