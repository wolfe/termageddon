<app-master-detail-layout
  sidebarTitle="Pending Reviews"
  sidebarSubtitle="Definitions waiting for approval"
>
  <!-- Sidebar Content -->
  <div sidebar>
    <!-- Status Summary -->
    <app-status-summary [items]="getStatusSummaryItems()"></app-status-summary>

    <!-- Search and Filters -->
    <div class="mb-4">
      <app-search-filter-bar
        placeholder="Search terms..."
        [searchTerm]="state.searchTerm"
        [filters]="filters"
        [loading]="state.loading"
        [showPerspectiveFilter]="true"
        [perspectives]="perspectives"
        [selectedPerspectiveId]="selectedPerspectiveId"
        [showAuthorFilter]="true"
        [authors]="state.allUsers"
        [selectedAuthorId]="selectedAuthorId"
        [showSortOptions]="true"
        [sortOptions]="sortOptions"
        [selectedSortBy]="selectedSortBy"
        (searchTermChange)="state.searchTerm = $event"
        (search)="onSearch()"
        (filterChanged)="onFilterChanged($event)"
        (perspectiveChanged)="onPerspectiveChanged($event)"
        (authorChanged)="onAuthorChanged($event)"
        (sortChanged)="onSortChanged($event)"
        (cleared)="state.searchTerm = ''; onSearch()"
      ></app-search-filter-bar>
      
      <!-- Create Entry Button -->
      <div class="mt-3">
        <button
          (click)="openCreateDialog()"
          class="px-3 py-1 text-sm bg-termageddon-accent text-white rounded hover:bg-termageddon-primary transition-colors"
        >
          + Create Entry
        </button>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="state.loading" class="three-panel-loading">
      <div class="three-panel-loading-content">
        <div class="three-panel-loading-spinner"></div>
        <p class="three-panel-loading-text">Loading...</p>
      </div>
    </div>

    <!-- Error State -->
    <div *ngIf="state.error && !state.loading" class="three-panel-error">
      <div class="three-panel-error-content">
        <p class="three-panel-error-text">{{ state.error }}</p>
        <button
          (click)="loadPendingDrafts()"
          class="three-panel-error-button"
        >
          Retry
        </button>
      </div>
    </div>

    <!-- Drafts List -->
    <div *ngIf="!state.loading && !state.error" class="flex-1 overflow-y-auto">
      @if (state.filteredDrafts.length === 0) {
        <div class="three-panel-no-results">
          <p class="three-panel-no-results-text">
            @if (state.drafts.length === 0) {
              No pending reviews found.
            } @else {
              No matches found for "{{ state.searchTerm }}".
            }
          </p>
        </div>
      } @else {
        @for (draft of state.filteredDrafts; track draft.id) {
          <app-draft-list-item
            [draft]="draft"
            [selected]="state.selectedDraft?.id === draft.id"
            [showStatus]="false"
            statusType="eligibility"
            [showPublishButton]="true"
            [showApprovalStatus]="true"
            context="review"
            (clicked)="selectDraft($event)"
            (publishClicked)="publishDraft($event)"
          ></app-draft-list-item>
        }
      }
    </div>
  </div>

  <!-- Detail Panel -->
  <div detail>
    <app-draft-detail-panel
      [context]="'review'"
      [draft]="state.selectedDraft"
      [canEdit]="canEditDraft()"
      [canPublishFlag]="true"
      [canApproveFlag]="true"
      [showPublishButton]="true"
      [showRequestReviewButton]="true"
      [showApproveButton]="true"
      [isLoadingComments]="state.isLoadingComments"
      [comments]="state.comments"
      [requestingReview]="state.requestingReview"
      [entryId]="state.selectedDraft?.entry?.id"
      [currentUserId]="state.currentUser?.id"
      [isEditMode]="isEditMode"
      (approve)="approveDraft()"
      (publish)="publishDraft(state.selectedDraft!)"
      (requestReview)="requestReview(state.selectedDraft!)"
      (editRequested)="onEditRequested()"
      (editSaved)="onEditSaved()"
      (editCancelled)="onEditCancelled()"
      (commentAdded)="onCommentAdded($event)"
      (commentResolved)="onCommentResolved($event)"
      (commentUnresolved)="onCommentUnresolved($event)"
    ></app-draft-detail-panel>
  </div>
</app-master-detail-layout>

<!-- Reviewer Selector Dialog -->
<app-reviewer-selector-dialog
  [isOpen]="state.showReviewerSelector"
  [users]="state.allUsers"
  [selectedReviewerIds]="state.selectedReviewerIds"
  [draftAuthorId]="state.selectedDraft?.author?.id"
  (close)="onReviewerSelectionCancelled()"
  (confirm)="onReviewerSelectionConfirmed($event)"
>
</app-reviewer-selector-dialog>

<!-- Create Entry Dialog -->
<app-create-entry-dialog
  [isOpen]="showCreateDialog"
  (close)="onDialogClosed()"
  (entryCreated)="onTermCreated($event)"
></app-create-entry-dialog>