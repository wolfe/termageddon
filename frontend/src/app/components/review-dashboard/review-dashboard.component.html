<app-master-detail-layout
  sidebarTitle="Pending Reviews"
  sidebarSubtitle="Definitions waiting for approval"
  sidebarWidth="w-2/5"
>
  <!-- Sidebar Content -->
  <div sidebar>
    <!-- Status Summary -->
    <div class="p-3 border-b border-gray-300">
      <div class="flex items-center space-x-4 text-xs">
        <span class="flex items-center">
          <span class="w-2 h-2 bg-blue-500 rounded-full mr-1"></span>
          {{ getEligibleCount() }} ready to approve
        </span>
        <span class="flex items-center">
          <span class="w-2 h-2 bg-green-500 rounded-full mr-1"></span>
          {{ getAlreadyApprovedCount() }} already approved
        </span>
        <span class="flex items-center">
          <span class="w-2 h-2 bg-gray-400 rounded-full mr-1"></span>
          {{ getOwnDraftsCount() }} your drafts
        </span>
      </div>
    </div>

    <!-- Search and Filters -->
    <app-search-filter-bar
      placeholder="Search terms, perspectives, authors..."
      [searchTerm]="state.searchTerm"
      [filters]="filters"
      [loading]="state.loading"
      (search)="onSearch()"
      (filterChanged)="onFilterChanged($event)"
      (cleared)="state.searchTerm = ''; onSearch()"
    ></app-search-filter-bar>

    <!-- Loading State -->
    <div *ngIf="state.loading" class="flex-1 flex items-center justify-center">
      <div class="text-center">
        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-termageddon-accent mx-auto"></div>
        <p class="text-gray-600 mt-2 text-sm">Loading...</p>
      </div>
    </div>

    <!-- Error State -->
    <div *ngIf="state.error && !state.loading" class="flex-1 flex items-center justify-center">
      <div class="text-center text-orange-600">
        <p class="text-sm">{{ state.error }}</p>
        <button
          (click)="loadPendingDrafts()"
          class="mt-2 px-3 py-1 bg-termageddon-accent text-white rounded hover:bg-termageddon-primary text-sm"
        >
          Retry
        </button>
      </div>
    </div>

    <!-- Drafts List -->
    <div *ngIf="!state.loading && !state.error" class="flex-1 overflow-y-auto">
      @if (state.filteredDrafts.length === 0) {
        <div class="p-4 text-center text-gray-500">
          <p class="text-sm">
            @if (state.drafts.length === 0) {
              No pending reviews found.
            } @else {
              No matches found for "{{ state.searchTerm }}".
            }
          </p>
        </div>
      } @else {
        @for (draft of state.filteredDrafts; track draft.id) {
          <app-draft-list-item
            [draft]="draft"
            [selected]="state.selectedDraft?.id === draft.id"
            [showStatus]="true"
            statusType="eligibility"
            [showPublishButton]="false"
            [showApprovalStatus]="true"
            (clicked)="selectDraft($event)"
          ></app-draft-list-item>
        }
      }
    </div>
  </div>

  <!-- Detail Panel -->
  <div detail>
    <app-draft-detail-panel
      [draft]="state.selectedDraft"
      [canEdit]="canEditDraft()"
      [canPublishFlag]="true"
      [canApproveFlag]="true"
      [showPublishButton]="true"
      [showRequestReviewButton]="true"
      [showApproveButton]="true"
      [isLoadingComments]="state.isLoadingComments"
      [comments]="state.comments"
      [requestingReview]="state.requestingReview"
      [entryId]="state.selectedDraft?.entry?.id"
      [currentUserId]="state.currentUser?.id"
      (approve)="approveDraft()"
      (publish)="publishDraft(state.selectedDraft!)"
      (requestReview)="requestReview(state.selectedDraft!)"
      (editRequested)="onEditRequested()"
      (editSaved)="onEditSaved()"
      (editCancelled)="onEditCancelled()"
      (commentAdded)="onCommentAdded($event)"
      (commentResolved)="onCommentResolved($event)"
      (commentUnresolved)="onCommentUnresolved($event)"
    ></app-draft-detail-panel>
  </div>
</app-master-detail-layout>

<!-- Reviewer Selector Dialog -->
<app-reviewer-selector-dialog
  [isOpen]="state.showReviewerSelector"
  [users]="state.allUsers"
  [selectedReviewerIds]="state.selectedReviewerIds"
  (close)="onReviewerSelectionCancelled()"
  (confirm)="onReviewerSelectionConfirmed($event)"
>
</app-reviewer-selector-dialog>