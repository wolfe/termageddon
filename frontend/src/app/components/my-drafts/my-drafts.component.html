<app-master-detail-layout
  sidebarTitle="My Drafts"
  sidebarSubtitle="Your draft definitions"
>
  <!-- Sidebar Content -->
  <div sidebar>
    <!-- Status Summary -->
    <app-status-summary [items]="getStatusSummaryItems()"></app-status-summary>

    <!-- Search -->
    <app-search-filter-bar
      placeholder="Search drafts..."
      [searchTerm]="state.searchTerm"
      [loading]="state.loading"
      (search)="onSearch()"
      (cleared)="state.searchTerm = ''; onSearch()"
    ></app-search-filter-bar>

    <!-- Draft List -->
    <div class="flex-1 overflow-y-auto">
      @if (state.loading) {
        <div class="three-panel-loading">
          <div class="three-panel-loading-content">
            <div class="three-panel-loading-spinner"></div>
            <p class="three-panel-loading-text">Loading drafts...</p>
          </div>
        </div>
      } @else if (state.error) {
        <div class="three-panel-error">
          <div class="three-panel-error-content">
            <p class="three-panel-error-text">{{ state.error }}</p>
            <button
              (click)="loadMyDrafts()"
              class="three-panel-error-button"
            >
              Retry
            </button>
          </div>
        </div>
      } @else if (state.filteredDrafts.length === 0) {
        <div class="three-panel-empty-state">
          <div class="three-panel-empty-content">
            <div class="three-panel-empty-logo">
              <img src="images/logo.png" alt="Termageddon Logo" />
            </div>
            @if (state.searchTerm) {
              <h2 class="three-panel-empty-title">No drafts found</h2>
              <p class="three-panel-empty-subtitle">Try adjusting your search terms</p>
            } @else {
              <h2 class="three-panel-empty-title">No drafts yet</h2>
              <p class="three-panel-empty-subtitle">Create drafts by editing terms</p>
            }
          </div>
        </div>
      } @else {
        @for (draft of state.filteredDrafts; track draft.id) {
          <app-draft-list-item
            [draft]="draft"
            [selected]="state.selectedDraft?.id === draft.id"
            [showStatus]="false"
            statusType="draft"
            [showPublishButton]="true"
            [showApprovalStatus]="true"
            context="my-drafts"
            (clicked)="selectDraft($event)"
            (publishClicked)="publishDraft($event)"
          ></app-draft-list-item>
        }
      }
    </div>
  </div>

  <!-- Detail Panel -->
  <div detail>
    @if (state.isNewEntryMode && state.newEntry) {
      <!-- New Entry Mode - Show fresh textbox for first draft -->
      <app-new-entry-detail-panel
        [entry]="state.newEntry"
        [currentUserId]="state.currentUser?.id || null"
        (createFirstDraft)="onCreateFirstDraft($event)"
      ></app-new-entry-detail-panel>
    } @else {
      <!-- Normal Draft Mode -->
      <app-draft-detail-panel
        [context]="'my-drafts'"
        [draft]="state.selectedDraft"
        [canEdit]="true"
        [canPublishFlag]="true"
        [canApproveFlag]="false"
        [showPublishButton]="true"
        [showRequestReviewButton]="true"
        [showApproveButton]="false"
        [isLoadingComments]="state.isLoadingComments"
        [comments]="state.comments"
        [requestingReview]="state.requestingReview"
        [entryId]="state.selectedDraft?.entry?.id"
        [currentUserId]="state.currentUser?.id"
        [isEditMode]="isEditMode"
        (approve)="onApprove()"
        (publish)="publishDraft(state.selectedDraft!)"
        (requestReview)="requestReviewers()"
        (editRequested)="onEditRequested()"
        (editSaved)="onEditSaved()"
        (editCancelled)="onEditCancelled()"
        (commentAdded)="onCommentAdded($event)"
        (commentResolved)="onCommentResolved($event)"
        (commentUnresolved)="onCommentUnresolved($event)"
      ></app-draft-detail-panel>
    }
  </div>
</app-master-detail-layout>

<!-- Reviewer Selector Dialog -->
<app-reviewer-selector-dialog
  [isOpen]="state.showReviewerSelector"
  [users]="state.allUsers"
  [selectedReviewerIds]="state.selectedReviewerIds"
  [draftAuthorId]="state.selectedDraft?.author?.id"
  (close)="onReviewerSelectionCancelled()"
  (confirm)="onReviewerSelectionConfirmed($event)"
>
</app-reviewer-selector-dialog>