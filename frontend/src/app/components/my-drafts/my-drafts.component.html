<app-master-detail-layout
  sidebarTitle="My Drafts"
  sidebarSubtitle="Your draft definitions"
  sidebarWidth="w-1/3"
>
  <!-- Sidebar Content -->
  <div sidebar>
    <!-- Search -->
    <app-search-filter-bar
      placeholder="Search drafts..."
      [searchTerm]="searchTerm"
      [loading]="loading"
      (search)="onSearch()"
      (cleared)="searchTerm = ''; onSearch()"
    ></app-search-filter-bar>

    <!-- Draft List -->
    <div class="flex-1 overflow-y-auto">
      @if (loading) {
        <div class="p-4 text-center text-gray-500">
          <p>Loading drafts...</p>
        </div>
      } @else if (error) {
        <div class="p-4 text-center text-red-600">
          <p>{{ error }}</p>
          <button
            (click)="loadMyDrafts()"
            class="mt-2 px-3 py-1 bg-termageddon-accent text-white rounded hover:bg-termageddon-primary text-sm"
          >
            Retry
          </button>
        </div>
      } @else if (filteredDrafts.length === 0) {
        <div class="p-4 text-center text-gray-500">
          @if (searchTerm) {
            <p>No drafts found</p>
          } @else {
            <p>No drafts yet</p>
            <p class="text-sm mt-1">Create drafts by editing terms</p>
          }
        </div>
      } @else {
        <div class="space-y-1 p-2">
          @for (draft of filteredDrafts; track draft.id) {
            <app-draft-list-item
              [draft]="draft"
              [selected]="selectedDraft?.id === draft.id"
              [showStatus]="true"
              statusType="draft"
              [showPublishButton]="true"
              (clicked)="selectDraft($event)"
              (publishClicked)="publishDraft($event)"
            ></app-draft-list-item>
          }
        </div>
      }
    </div>
  </div>

  <!-- Detail Panel -->
  <div detail>
    <app-draft-detail-panel
      [draft]="selectedDraft"
      [canEdit]="true"
      [canPublishFlag]="true"
      [canApproveFlag]="false"
      [showPublishButton]="true"
      [showRequestReviewButton]="true"
      [showApproveButton]="false"
      [isLoadingComments]="isLoadingComments"
      [comments]="comments"
      [requestingReview]="false"
      [editingDraft]="editingDraft"
      [editContent]="editContent"
      [currentUserId]="currentUser?.id"
      (approve)="onApprove()"
      (publish)="publishDraft(selectedDraft!)"
      (requestReview)="requestReviewers()"
      (edit)="toggleEditMode(selectedDraft!)"
      (saveEdit)="saveDraft(selectedDraft!)"
      (cancelEdit)="cancelEdit()"
      (commentAdded)="onCommentAdded($event)"
      (commentResolved)="onCommentResolved($event)"
      (commentUnresolved)="onCommentUnresolved($event)"
    ></app-draft-detail-panel>
  </div>
</app-master-detail-layout>

<!-- Reviewer Selector Dialog -->
<app-reviewer-selector-dialog
  [isOpen]="showReviewerSelector"
  [users]="allUsers"
  [selectedReviewerIds]="selectedReviewerIds"
  (close)="onReviewerSelectionCancelled()"
  (confirm)="onReviewerSelectionConfirmed($event)"
>
</app-reviewer-selector-dialog>