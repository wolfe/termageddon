<app-master-detail-layout
  sidebarTitle="My Drafts"
  sidebarSubtitle="Your draft definitions"
  sidebarWidth="w-1/3"
>
  <!-- Sidebar Content -->
  <div sidebar>
    <!-- Search -->
    <app-search-filter-bar
      placeholder="Search drafts..."
      [searchTerm]="state.searchTerm"
      [loading]="state.loading"
      (search)="onSearch()"
      (cleared)="state.searchTerm = ''; onSearch()"
    ></app-search-filter-bar>

    <!-- Draft List -->
    <div class="flex-1 overflow-y-auto">
      @if (state.loading) {
        <div class="p-4 text-center text-gray-500">
          <p>Loading drafts...</p>
        </div>
      } @else if (state.error) {
        <div class="p-4 text-center text-red-600">
          <p>{{ state.error }}</p>
          <button
            (click)="loadMyDrafts()"
            class="mt-2 px-3 py-1 bg-termageddon-accent text-white rounded hover:bg-termageddon-primary text-sm"
          >
            Retry
          </button>
        </div>
      } @else if (state.filteredDrafts.length === 0) {
        <div class="p-4 text-center text-gray-500">
          @if (state.searchTerm) {
            <p>No drafts found</p>
          } @else {
            <p>No drafts yet</p>
            <p class="text-sm mt-1">Create drafts by editing terms</p>
          }
        </div>
      } @else {
        <div class="space-y-1 p-2">
          @for (draft of state.filteredDrafts; track draft.id) {
            <app-draft-list-item
              [draft]="draft"
              [selected]="state.selectedDraft?.id === draft.id"
              [showStatus]="true"
              statusType="draft"
              [showPublishButton]="true"
              (clicked)="selectDraft($event)"
              (publishClicked)="publishDraft($event)"
            ></app-draft-list-item>
          }
        </div>
      }
    </div>
  </div>

  <!-- Detail Panel -->
  <div detail>
    <app-draft-detail-panel
      [draft]="state.selectedDraft"
      [canEdit]="true"
      [canPublishFlag]="true"
      [canApproveFlag]="false"
      [showPublishButton]="true"
      [showRequestReviewButton]="true"
      [showApproveButton]="false"
      [isLoadingComments]="state.isLoadingComments"
      [comments]="state.comments"
      [requestingReview]="state.requestingReview"
      [entryId]="state.selectedDraft?.entry?.id"
      [currentUserId]="state.currentUser?.id"
      (approve)="onApprove()"
      (publish)="publishDraft(state.selectedDraft!)"
      (requestReview)="requestReviewers()"
      (editRequested)="onEditRequested()"
      (editSaved)="onEditSaved()"
      (editCancelled)="onEditCancelled()"
      (commentAdded)="onCommentAdded($event)"
      (commentResolved)="onCommentResolved($event)"
      (commentUnresolved)="onCommentUnresolved($event)"
    ></app-draft-detail-panel>
  </div>
</app-master-detail-layout>

<!-- Reviewer Selector Dialog -->
<app-reviewer-selector-dialog
  [isOpen]="state.showReviewerSelector"
  [users]="state.allUsers"
  [selectedReviewerIds]="state.selectedReviewerIds"
  (close)="onReviewerSelectionCancelled()"
  (confirm)="onReviewerSelectionConfirmed($event)"
>
</app-reviewer-selector-dialog>