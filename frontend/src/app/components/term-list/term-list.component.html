<div class="h-full flex flex-col bg-white">
  <!-- Search and Filters -->
  <div class="p-3 border-b border-gray-300">
    <app-search-filter-bar
      placeholder="Search terms..."
      [searchTerm]="searchControl.value || ''"
      [loading]="isLoading"
      [showPerspectiveFilter]="true"
      [perspectives]="perspectives"
      [selectedPerspectiveId]="perspectiveControl.value ? +perspectiveControl.value : null"
      [showAuthorFilter]="true"
      [authors]="users"
      [selectedAuthorId]="authorControl.value ? +authorControl.value : null"
      [showSortOptions]="true"
      [sortOptions]="sortOptions"
      [selectedSortBy]="sortControl.value || '-published_at'"
      [showClearFiltersButton]="true"
      [showCreateButton]="true"
      (searchTermChange)="searchControl.setValue($event)"
      (search)="loadEntries()"
      (perspectiveChanged)="onPerspectiveChanged($event)"
      (authorChanged)="onAuthorChanged($event)"
      (sortChanged)="onSortChanged($event)"
      (clearFilters)="clearFilters()"
      (createClicked)="openCreateDialog()"
    ></app-search-filter-bar>
  </div>

  <!-- Entry List -->
  <div class="flex-1 overflow-y-auto">
    @if (isLoading) {
      <div class="p-4 text-center text-gray-500">
        <p>Loading...</p>
      </div>
    } @else if (getGroupedTermsArray().length === 0) {
      <div class="p-4 text-center text-gray-500">
        <p>No entries found</p>
      </div>
    } @else {
      @for (termEntries of getGroupedTermsArray(); track termEntries[0].term.id) {
        <div
          class="p-3 border-b border-gray-200 hover:bg-gray-50"
        >
          <div class="flex items-start justify-between">
            <div class="flex-1">
              <!-- Term Name (clickable to select first perspective) -->
              <h3 
                (click)="selectTerm(termEntries)"
                data-testid="term-name"
                [class.bg-termageddon-gray-light]="selectedEntry?.term?.id === termEntries[0].term.id"
                class="font-semibold text-sm text-termageddon-gray-dark cursor-pointer hover:text-termageddon-primary"
              >
                {{ termEntries[0].term.text }}
              </h3>
              
              <!-- Perspective Bubbles -->
              <div class="flex flex-wrap gap-1 mt-2">
                @for (entry of termEntries; track entry.id) {
                  <app-perspective-pill 
                    [perspective]="entry.perspective"
                    size="small"
                    [variant]="selectedEntry?.id === entry.id ? 'selected' : 'unselected'"
                    [clickable]="true"
                    [maxLength]="10"
                    (click)="selectEntryByPerspective(entry)"
                    data-testid="perspective-bubble"
                  ></app-perspective-pill>
                }
              </div>
            </div>
            <div class="flex flex-col items-end">
              @if (hasAnyEndorsedEntry(termEntries)) {
                <span
                  class="px-2 py-0.5 bg-green-400 text-black text-xs rounded font-semibold"
                >
                  Endorsed
                </span>
              }
            </div>
          </div>
        </div>
      }
    }
  </div>

  <!-- Entry Creation Dialog -->
  <app-create-entry-dialog
    [isOpen]="showCreateDialog"
    (close)="onDialogClosed()"
    (entryCreated)="onTermCreated($event)"
  ></app-create-entry-dialog>
</div>
