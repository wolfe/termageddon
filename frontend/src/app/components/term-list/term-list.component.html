<div class="h-full flex flex-col bg-white">
  <!-- Search and Filters -->
  <div class="p-3 border-b border-gray-300 space-y-3">
    <!-- Search Input -->
    <div class="relative">
      <input
        type="text"
        [formControl]="searchControl"
        data-testid="term-search-input"
        placeholder="Search terms..."
        class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-termageddon-accent text-sm"
      />
      @if (searchControl.value) {
        <button
          (click)="searchControl.setValue('')"
          class="absolute right-2 top-2 text-gray-400 hover:text-gray-600"
        >
          âœ•
        </button>
      }
    </div>

    <!-- Perspective Filter -->
    <select
      [formControl]="perspectiveControl"
      data-testid="perspective-filter-select"
      class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-termageddon-accent text-sm"
    >
      <option value="">All Perspectives</option>
      @for (perspective of perspectives; track perspective.id) {
        <option [value]="perspective.id">{{ perspective.name }}</option>
      }
    </select>

    <!-- Author Filter -->
    <select
      [formControl]="authorControl"
      class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-termageddon-accent text-sm"
    >
      <option value="">All Authors</option>
      @for (user of users; track user.id) {
        <option [value]="user.id">{{ user.first_name }} {{ user.last_name }}</option>
      }
    </select>

    <!-- Sort Controls -->
    <div class="flex items-center space-x-2">
      <label class="text-sm text-gray-600">Sort by:</label>
      <select
        [formControl]="sortControl"
        class="px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-termageddon-accent text-sm"
      >
        <option value="term__text_normalized">Term Name (A-Z)</option>
        <option value="-term__text_normalized">Term Name (Z-A)</option>
        <option value="-created_at">Newest First</option>
        <option value="created_at">Oldest First</option>
        <option value="-updated_at">Recently Updated</option>
      </select>
    </div>

    <!-- Action Buttons -->
    <div class="flex items-center justify-between">
      <div class="flex items-center space-x-2">
        @if (getFilterCount() > 0) {
          <button
            (click)="clearFilters()"
            class="px-3 py-1 text-sm text-termageddon-accent hover:text-termageddon-primary border border-termageddon-accent rounded hover:bg-termageddon-accent hover:text-white transition-colors"
          >
            Clear Filters ({{ getFilterCount() }})
          </button>
        }
      </div>
      
      <button
        (click)="openCreateDialog()"
        class="px-3 py-1 text-sm bg-termageddon-accent text-white rounded hover:bg-termageddon-primary transition-colors"
      >
        + Create Term
      </button>
    </div>
  </div>

  <!-- Entry List -->
  <div class="flex-1 overflow-y-auto">
    @if (isLoading) {
      <div class="p-4 text-center text-gray-500">
        <p>Loading...</p>
      </div>
    } @else if (getGroupedTermsArray().length === 0) {
      <div class="p-4 text-center text-gray-500">
        <p>No entries found</p>
      </div>
    } @else {
      @for (termEntries of getGroupedTermsArray(); track termEntries[0].term.id) {
        <div
          class="p-3 border-b border-gray-200 hover:bg-gray-50"
        >
          <div class="flex items-start justify-between">
            <div class="flex-1">
              <!-- Term Name (clickable to select first perspective) -->
              <h3 
                (click)="selectTerm(termEntries)"
                data-testid="term-name"
                [class.bg-termageddon-gray-light]="selectedEntry?.term?.id === termEntries[0].term.id"
                class="font-semibold text-sm text-termageddon-gray-dark cursor-pointer hover:text-termageddon-primary"
              >
                {{ termEntries[0].term.text }}
              </h3>
              
              <!-- Perspective Bubbles -->
              <div class="flex flex-wrap gap-1 mt-2">
                @for (entry of termEntries; track entry.id) {
                  <app-perspective-pill 
                    [perspective]="entry.perspective"
                    size="small"
                    [variant]="selectedEntry?.id === entry.id ? 'selected' : 'unselected'"
                    [clickable]="true"
                    [maxLength]="10"
                    (click)="selectEntryByPerspective(entry)"
                    data-testid="perspective-bubble"
                  ></app-perspective-pill>
                }
              </div>
            </div>
            <div class="flex flex-col items-end">
              @if (hasAnyEndorsedEntry(termEntries)) {
                <span
                  class="px-2 py-0.5 bg-green-400 text-black text-xs rounded font-semibold"
                >
                  Endorsed
                </span>
              }
            </div>
          </div>
        </div>
      }
    }
  </div>

  <!-- Term Creation Dialog -->
  <app-term-dialog
    [isOpen]="showCreateDialog"
    (close)="onDialogClosed()"
    (termCreated)="onTermCreated($event)"
  ></app-term-dialog>
</div>
